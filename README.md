## Captive Portal on Rapsberry Pi with WordPress [DRAFT, DO NOT USE]

## Copy of https://github.com/tretos53/Captive-Portal, trying to get WP working with Captive Portal. NOT EASY and it doesnt work at the moment.

Image: 2019-04-08-raspbian-stretch-lite.zip

From: https://www.nginx.com/blog/installing-wordpress-with-nginx-unit/

sudo -i
apt-get update -y
apt-get install mysql-server -y
UPDATE mysql.user SET Password=PASSWORD('Pa55w04d123') WHERE User='root';
DELETE FROM mysql.user WHERE User='';
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
DROP DATABASE test;
DELETE FROM mysql.db WHERE Db='test' OR Db='test\_%';
FLUSH PRIVILEGES;

dbsetup="create database wordpress;GRANT ALL PRIVILEGES ON wordpress.* TO wordpress@$localhost IDENTIFIED BY 'Pa55w04d123';FLUSH PRIVILEGES;"
mysql -e "$dbsetup"


cd /var/www/
wget http://wordpress.org/latest.tar.gz
tar xzvf latest.tar.gz
cd /var/www/wordpress
cp wp-config-sample.php wp-config.php
curl -s https://api.wordpress.org/secret-key/1.1/salt/ and copy to wp-config.php
nano wp-config.php
// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');

/** MySQL database username */
define('DB_USER', 'wpuser');

/** MySQL database password */
define('DB_PASSWORD', 'secure_password');

define('AUTH_KEY',         'value generated by salt');
define('SECURE_AUTH_KEY',  'value generated by salt');
define('LOGGED_IN_KEY',    'value generated by salt');
define('NONCE_KEY',        'value generated by salt');
define('AUTH_SALT',        'value generated by salt');
define('SECURE_AUTH_SALT', 'value generated by salt');
define('LOGGED_IN_SALT',   'value generated by salt');
define('NONCE_SALT',       'value generated by salt');

chown -R wpuser:www-data /var/www/wordpress
find /var/www/wordpress -type d -exec chmod g+s {} \;
chmod g+w /var/www/wordpress/wp-content
chmod -R g+w /var/www/wordpress/wp-content/themes
chmod -R g+w /var/www/wordpress/wp-content/plugins

apt-get install -y php7.0 php7.0-common php7.0-mbstring php7.0-gd php7.0-intl php7.0-xml php7.0-mysql php7.0-mcrypt

apt-get install unit-php
service unit restart
curl -X PUT --data-binary @/usr/share/doc/unit-php/examples/unit.config --unix-socket /run/control.unit.sock http://localhost/config 
curl http://localhost:8300/

cd /var/www/wordpress
nano wordpress.config



Below works.

```
apt-get update -y
apt-get install nginx -y
apt-get install mysql-server php-mysql -y
apt-get install php7.0-fpm -y

curl -o /var/www/html/latest.tar.gz -O https://wordpress.org/latest.tar.gz
tar -C /var/www/html/ -zxvf /var/www/html/latest.tar.gz
rm -rf /var/www/html/latest.tar.gz
chown -R www-data /var/www/html/wordpress
mkdir /var/www/html/wordpress/wp-content/uploads
chmod 775 /var/www/html/wordpress/wp-content/uploads
wget -q https://raw.githubusercontent.com/tretos53/Captive-Portal-WordPress/master/default_nginx -O /etc/nginx/sites-enabled/default

service nginx restart

To create DB
https://projects.raspberrypi.org/en/projects/lamp-web-server-with-wordpress/8

FOr some reason WP installs but it doesnt create all the tables. DO below to fix it

define('WP_ALLOW_REPAIR', true); to repair db http://192.168.0.20/wp-admin/maint/repair.php
```
